/*!
 * @usecsv/js v0.14.2
 * (c) layercode
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).useCsvPlugin=n()}(this,(function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},e.apply(this,arguments)},n=[],t=[];function o(e,o){if(o=o||{},void 0===e)throw new Error("insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).");var r,i=!0===o.prepend?"prepend":"append",s=void 0!==o.container?o.container:document.querySelector("head"),a=n.indexOf(s);return-1===a&&(a=n.push(s)-1,t[a]={}),void 0!==t[a]&&void 0!==t[a][i]?r=t[a][i]:(r=t[a][i]=function(){var e=document.createElement("style");return e.setAttribute("type","text/css"),e}(),"prepend"===i?s.insertBefore(r,s.childNodes[0]):s.appendChild(r)),65279===e.charCodeAt(0)&&(e=e.substr(1,e.length)),r.styleSheet?r.styleSheet.cssText+=e:r.textContent+=e,r}var r,i,s,a,c,d=o;o.insertCss=d,function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"}(r||(r={})),function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"}(i||(i={})),function(e){e.ConnectionDestroyed="ConnectionDestroyed",e.ConnectionTimeout="ConnectionTimeout",e.NoIframeSrc="NoIframeSrc"}(s||(s={})),function(e){e.DataCloneError="DataCloneError"}(a||(a={})),function(e){e.Message="message"}(c||(c={}));const l={"http:":"80","https:":"443"},u=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,m=["file:","data:"];const p=({name:e,message:n,stack:t})=>({name:e,message:n,stack:t});let f=0;var h=()=>++f;const g=e=>e?e.split("."):[],v=(e,n,t)=>{const o=g(n);return o.reduce(((e,n,r)=>(void 0===e[n]&&(e[n]={}),r===o.length-1&&(e[n]=t),e[n])),e),e},y=(e,n)=>{const t={};return Object.keys(e).forEach((o=>{const r=e[o],i=((e,n)=>{const t=g(n||"");return t.push(e),(e=>e.join("."))(t)})(o,n);"object"==typeof r&&Object.assign(t,y(r,i)),"function"==typeof r&&(t[i]=r)})),t};var w=(e,n,t,o,a)=>{const{localName:d,local:l,remote:u,originForSending:m,originForReceiving:p}=n;let f=!1;a(`${d}: Connecting call sender`);const g=e=>(...n)=>{let t;a(`${d}: Sending ${e}() call`);try{u.closed&&(t=!0)}catch(e){t=!0}if(t&&o(),f){const n=new Error(`Unable to send ${e}() call due to destroyed connection`);throw n.code=s.ConnectionDestroyed,n}return new Promise(((t,o)=>{const s=h(),f=n=>{if(n.source!==u||n.data.penpal!==r.Reply||n.data.id!==s)return;if("*"!==p&&n.origin!==p)return void a(`${d} received message from origin ${n.origin} which did not match expected origin ${p}`);const m=n.data;a(`${d}: Received ${e}() reply`),l.removeEventListener(c.Message,f);let h=m.returnValue;m.returnValueIsError&&(h=(e=>{const n=new Error;return Object.keys(e).forEach((t=>n[t]=e[t])),n})(h)),(m.resolution===i.Fulfilled?t:o)(h)};l.addEventListener(c.Message,f);const g={penpal:r.Call,id:s,methodName:e,args:n};u.postMessage(g,m)}))},y=t.reduce(((e,n)=>(e[n]=g(n),e)),{});return Object.assign(e,(e=>{const n={};for(const t in e)v(n,t,e[t]);return n})(y)),()=>{f=!0}},E=(e,n,t,o,s)=>{const{destroy:d,onDestroy:l}=o;let u,m;const f={};return o=>{if("*"!==n&&o.origin!==n)return void s(`Parent: Handshake - Received ACK message from origin ${o.origin} which did not match expected origin ${n}`);s("Parent: Handshake - Received ACK");const h={localName:"Parent",local:window,remote:o.source,originForSending:t,originForReceiving:n};u&&u(),u=((e,n,t)=>{const{localName:o,local:s,remote:d,originForSending:l,originForReceiving:u}=e;let m=!1;const f=e=>{if(e.source!==d||e.data.penpal!==r.Call)return;if("*"!==u&&e.origin!==u)return void t(`${o} received message from origin ${e.origin} which did not match expected origin ${u}`);const s=e.data,{methodName:c,args:f,id:h}=s;t(`${o}: Received ${c}() call`);const g=e=>n=>{if(t(`${o}: Sending ${c}() reply`),m)return void t(`${o}: Unable to send ${c}() reply due to destroyed connection`);const s={penpal:r.Reply,id:h,resolution:e,returnValue:n};e===i.Rejected&&n instanceof Error&&(s.returnValue=p(n),s.returnValueIsError=!0);try{d.postMessage(s,l)}catch(e){if(e.name===a.DataCloneError){const n={penpal:r.Reply,id:h,resolution:i.Rejected,returnValue:p(e),returnValueIsError:!0};d.postMessage(n,l)}throw e}};new Promise((e=>e(n[c].apply(n,f)))).then(g(i.Fulfilled),g(i.Rejected))};return s.addEventListener(c.Message,f),()=>{m=!0,s.removeEventListener(c.Message,f)}})(h,e,s),l(u),m&&m.forEach((e=>{delete f[e]})),m=o.data.methodNames;const g=w(f,h,m,d,s);return l(g),f}};var C=e=>{let{iframe:n,methods:t={},childOrigin:o,timeout:i,debug:a=!1}=e;const d=(e=>(...n)=>{e&&console.log("[Penpal]",...n)})(a),p=((e,n)=>{const t=[];let o=!1;return{destroy(r){o||(o=!0,n(`${e}: Destroying connection`),t.forEach((e=>{e(r)})))},onDestroy(e){o?e():t.push(e)}}})("Parent",d),{onDestroy:f,destroy:h}=p;o||((e=>{if(!e.src&&!e.srcdoc){const e=new Error("Iframe must have src or srcdoc property defined.");throw e.code=s.NoIframeSrc,e}})(n),o=(e=>{if(e&&m.find((n=>e.startsWith(n))))return"null";const n=document.location,t=u.exec(e);let o,r,i;return t?(o=t[1]?t[1]:n.protocol,r=t[2],i=t[4]):(o=n.protocol,r=n.hostname,i=n.port),`${o}//${r}${i&&i!==l[o]?`:${i}`:""}`})(n.src));const g="null"===o?"*":o,v=y(t),w=((e,n,t,o)=>i=>{if(!i.source)return;if("*"!==t&&i.origin!==t)return void e(`Parent: Handshake - Received SYN message from origin ${i.origin} which did not match expected origin ${t}`);e("Parent: Handshake - Received SYN, responding with SYN-ACK");const s={penpal:r.SynAck,methodNames:Object.keys(n)};i.source.postMessage(s,o)})(d,v,o,g),C=E(v,o,g,p,d),$=new Promise(((e,t)=>{const o=((e,n)=>{let t;return void 0!==e&&(t=window.setTimeout((()=>{const t=new Error(`Connection timed out after ${e}ms`);t.code=s.ConnectionTimeout,n(t)}),e)),()=>{clearTimeout(t)}})(i,h),a=t=>{if(t.source===n.contentWindow&&t.data)if(t.data.penpal!==r.Syn)if(t.data.penpal!==r.Ack);else{const n=C(t);n&&(o(),e(n))}else w(t)};window.addEventListener(c.Message,a),d("Parent: Awaiting handshake"),((e,n)=>{const{destroy:t,onDestroy:o}=n,r=setInterval((()=>{e.isConnected||(clearInterval(r),t())}),6e4);o((()=>{clearInterval(r)}))})(n,p),f((e=>{window.removeEventListener(c.Message,a),e&&t(e)}))}));return{promise:$,destroy(){h()}}},$=["interactive","complete"],b=function(e,n){return new Promise((function(t){e&&"function"!=typeof e&&(n=e,e=null),n=n||window.document;var o=function(){return t(void(e&&setTimeout(e)))};-1!==$.indexOf(n.readyState)?o():n.addEventListener("DOMContentLoaded",o)}))};b.resume=function(e){return function(n){return b(e).then((function(){return n}))}};return function(n){var t=n.importerKey,o=n.user,r=n.metadata,i=n.onData,s=n.onRecordsInitial,a=n.onRecordEdit,c=n.importerDisplay,l=void 0===c?"modal":c,u=n.onClose,m=n.theme,p=n.batchSize,f=n.sampleFileURL,h=n.downloadExampleButton,g=void 0===h||h,v=n.dynamicColumns,y="usecsv-".concat(Math.round(1e8*Math.random()));return b().then((function(){var n=function(e,n){var t=document.getElementById("usecsv-importer-inline-wrapper");d("\n  ".concat("modal"!==n&&t?"":".usecsv_container { position: fixed; top: 0px; bottom: 0; right: 0; left: 0; z-index: 100000; }","\n  .usecsv_container iframe {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    border-width: 0;\n  }\n  .usecsv_container {\n    overflow: hidden;\n    overscroll-behavior-x: none;\n  }\n")),document.body.insertAdjacentHTML("beforeend","<div id=".concat(e,' class="usecsv_container loading"></div>'));var o=document.createElement("iframe");o.setAttribute("src","https://app.usecsv.com/importer");var r=document.getElementById(e);return null==r||r.appendChild(o),"inline"===n&&t&&(null==t||t.appendChild(r)),o}(y,l),c=function(){var e;null===(e=document.getElementById(y))||void 0===e||e.remove()},h=C({iframe:n,methods:e(e(e(e({closeIframe:c},i?{onData:function(e){return i(e,c)}}:{}),s?{onRecordsInitial:s}:{}),a?{onRecordEdit:a}:{}),u?{onClose:u}:{})});return h.promise.then((function(e){var n;null===(n=document.getElementById(y))||void 0===n||n.classList.remove("loading"),e.setParams&&e.setParams({importerKey:t,user:o,metadata:r,importerDisplay:l,theme:m,batchSize:p,sampleFileURL:f,downloadExampleButton:g,dynamicColumns:v})})),h}))}}));
//# sourceMappingURL=index.umd.min.js.map
